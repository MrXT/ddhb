<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.manzz.clcw.module.lm.dao.LmWtClasslineDAO" >

  <resultMap id="LmWtClasslineResultMap" type="com.manzz.clcw.domain.LmWtClassline" >
    <id column="CLASSLINE_ID" property="classlineId" jdbcType="VARCHAR" />
    <result column="LINE_ID" property="lineId" jdbcType="VARCHAR" />
    <result column="CLASSLINE_NAME" property="classlineName" jdbcType="VARCHAR" />
    <result column="SITE_LIST" property="siteList" jdbcType="VARCHAR" />
    <result column="OPER_ID" property="operId" jdbcType="VARCHAR" />
    <result column="OPER_TIME" property="operTime" jdbcType="TIMESTAMP" />
  </resultMap>

  <sql id="LmWtClassline_Column_List" >
    CLASSLINE_ID, LINE_ID, CLASSLINE_NAME, SITE_LIST, OPER_ID, OPER_TIME
  </sql>

  <select id="selectByPrimaryKey" resultMap="LmWtClasslineResultMap" parameterType="java.lang.String" >
    select 
    <include refid="LmWtClassline_Column_List" />
    from wt_classline
    where CLASSLINE_ID = #{classlineId,jdbcType=VARCHAR}
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from wt_classline
    where CLASSLINE_ID = #{classlineId,jdbcType=VARCHAR}
  </delete>

  <insert id="insert" parameterType="com.manzz.clcw.domain.LmWtClassline" >
    insert into wt_classline (CLASSLINE_ID, LINE_ID, CLASSLINE_NAME, SITE_LIST, 
      OPER_ID, OPER_TIME)
    values (uuid(), #{lineId,jdbcType=VARCHAR}, #{classlineName,jdbcType=VARCHAR}, #{siteList,jdbcType=VARCHAR}, 
      #{operId,jdbcType=VARCHAR}, now())
  </insert>
  
  <update id="updateClasslinesByLine"  >
  	begin
  	 <foreach collection="list" item="item" separator=";">
  	 	 update wt_classline
    	set LINE_ID = #{item.lineId,jdbcType=VARCHAR},
      	CLASSLINE_NAME = #{item.classlineName,jdbcType=VARCHAR},
      	SITE_LIST = #{item.siteList,jdbcType=VARCHAR}
   	 where CLASSLINE_ID = #{item.classlineId,jdbcType=VARCHAR}
    </foreach>;
    end;
  </update>

  <update id="updateByPrimaryKeySelective" parameterType="com.manzz.clcw.domain.LmWtClassline" >
    update wt_classline
    <set >
      <if test="lineId != null" >
        LINE_ID = #{lineId,jdbcType=VARCHAR},
      </if>
      <if test="classlineName != null" >
        CLASSLINE_NAME = #{classlineName,jdbcType=VARCHAR},
      </if>
      <if test="siteList != null" >
        SITE_LIST = #{siteList,jdbcType=VARCHAR},
      </if>
      <if test="operId != null" >
        OPER_ID = #{operId,jdbcType=VARCHAR},
      </if>
      <if test="operTime != null" >
        OPER_TIME = now(),
      </if>
    </set>
    where CLASSLINE_ID = #{classlineId,jdbcType=VARCHAR}
  </update>

  <update id="updateByPrimaryKey" parameterType="com.manzz.clcw.domain.LmWtClassline" >
    update wt_classline
    set LINE_ID = #{lineId,jdbcType=VARCHAR},
      CLASSLINE_NAME = #{classlineName,jdbcType=VARCHAR},
      SITE_LIST = #{siteList,jdbcType=VARCHAR},
      OPER_ID = #{operId,jdbcType=VARCHAR},
      OPER_TIME = now()
    where CLASSLINE_ID = #{classlineId,jdbcType=VARCHAR}
  </update>

  <sql id="Where_Condition" >
    <where >
      <if test="lineId != null and lineId != ''" >
        LINE_ID = #{lineId,jdbcType=VARCHAR}
      </if>
      <if test="classlineName != null and classlineName != ''" >
        AND CLASSLINE_NAME = #{classlineName,jdbcType=VARCHAR}
      </if>
      <if test="siteList != null and siteList != ''" >
        AND SITE_LIST = #{siteList,jdbcType=VARCHAR}
      </if>
    </where>
  </sql>

  <sql id="Where_Fuzzy_Condition" >
    <where >
      <if test="lineId != null and lineId != ''" >
        LINE_ID = #{lineId,jdbcType=VARCHAR}
      </if>
      <if test="classlineName != null and classlineName != ''" >
        AND CLASSLINE_NAME = #{classlineName,jdbcType=VARCHAR}
      </if>
      <if test="siteList != null and siteList != ''" >
        AND SITE_LIST = #{siteList,jdbcType=VARCHAR}
      </if>
    </where>
  </sql>

  <select id="queryCount" parameterType="com.manzz.clcw.domain.LmWtClassline" resultType="java.lang.Integer" >
    select count(0) from wt_classline
    <if test="isFuzzyQuery == false" >
      <include refid="Where_Condition" />
    </if>
    <if test="isFuzzyQuery == true" >
      <include refid="Where_Fuzzy_Condition" />
    </if>
  </select>

  <select id="queryPagedList" parameterType="com.manzz.clcw.domain.LmWtClassline" resultMap="LmWtClasslineResultMap" >
    select 
    <include refid="LmWtClassline_Column_List" />
    from wt_classline
    <if test="isFuzzyQuery == false" >
      <include refid="Where_Condition" />
    </if>
    <if test="isFuzzyQuery == true" >
      <include refid="Where_Fuzzy_Condition" />
    </if>
    <if test="sort != null" >
      ORDER BY ${sort} ${order}
    </if>
    <if test="sort == null" >
      ORDER BY OPER_TIME DESC
    </if>
  </select>
  
  <select id="queryClassLineByCompany" resultType="com.manzz.clcw.module.lm.web.vo.LmWtClasslineVo" >
    select 
    CLASSLINE_ID classlineId, cl.LINE_ID lineId, CLASSLINE_NAME classlineName, SITE_LIST siteList,
    l.ticketprice ticketprice
    from wt_classline cl,wt_lines l
    where l.line_id = cl.line_id
    <if test="lineId != null and lineId != ''">
    	and l.line_id = #{lineId,jdbcType=VARCHAR}
    </if>
    <if test="lineId == null or lineId == ''">
    	and l.departure = #{departure,jdbcType=INTEGER}
    	and l.destination = #{destination,jdbcType=INTEGER}
    	and l.company = #{company,jdbcType=VARCHAR}
    </if>
  </select>
  <select id="queryClassLineByLine" resultType="com.manzz.clcw.module.lm.web.vo.LmWtClasslineVo" >
    select 
    cl.CLASSLINE_ID classlineId, cl.LINE_ID lineId, cl.CLASSLINE_NAME classlineName, cl.SITE_LIST siteList,
    count(f.frequency_id) frequencytotal
    from wt_classline cl
    left join wt_frequency f on f.CLASSLINE_ID = cl.CLASSLINE_ID
    where cl.line_id = #{lineId,jdbcType=VARCHAR}
    group by cl.CLASSLINE_ID
  </select>
  <select id="querySiteNameBySiteNumbers"  resultType="com.manzz.clcw.domain.LmWtSites" >
    select 
     sitename, sitenumber,site_id siteId,REGION_CODE regionCode
    from wt_site
    where 
    sitenumber in 
    <foreach collection="array" item="item" open="(" separator="," close=")">
    	cast(#{item} as SIGNED INTEGER) 
    </foreach>
    <!-- 按数组里数字顺序排序 -->
    order by field
    <foreach collection="array" item="item" open="(sitenumber," separator="," close=")">
    	cast(#{item} as SIGNED INTEGER) 
    </foreach>
    
  </select>
</mapper>
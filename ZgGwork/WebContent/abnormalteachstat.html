<!DOCTYPE html>
<html>
	<head>
		  <title>驾驶员培训行管平台</title>
		  <meta charset="utf-8">
		  <meta name="viewport" content="width=device-width, 
		                                     initial-scale=1.0, 
		                                     maximum-scale=1.0, 
		                                     user-scalable=no">
		  <link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css">  
		  <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
		  <script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
		  <script language="javascript" type="text/javascript" src="libs/My97DatePicker/WdatePicker.js"></script>
          <link rel="stylesheet" href="css/index.css" type="text/css" />
	</head>
	<body>
		<table style="width:100%;height:4rem;">
	    	<tr class="row" style="height:100%;width:100%;background:#2BB464;">
	    		<td class="col-xs-1 btn-primary" style="height:100%;text-align:center;background:#2BB464;" onclick="reback()"><img style="width:1rem;height:1.4rem;" src='img/ic_reback.png'/></td>
	    		<td class="col-xs-11" style="height:100%;text-align:left;"><strong style="color:#ffffff;font-size:1.7rem;">异常培训统计</strong></td>
	    	</tr>
        </table>
        <div class="input-group" style="margin-top:1.6rem;">
        	 <input type="text" class="form-control" placeholder="请输入开始时间" id="start_time" onClick="WdatePicker()">
	         <input type="text" class="form-control" placeholder="请输入结束时间" id="end_time" onClick="WdatePicker()">
	         <span class="input-group-addon btn-success" onclick="searchStatData()">提交</span>
        </div>
        <div id="stat_data" style="margin-top:1.6rem;">
        </div>
        <table border="1" bordercolor="#D2D2D2" id="data_list">
	    </table>
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
		   aria-labelledby="myModalLabel" aria-hidden="true">
		   <div class="modal-dialog">
		      <div class="modal-content">
		         <div class="modal-body">
		           努力加载中,请稍后...
		         </div>
		 </div>
		<script type="text/javascript">
            $(function(){
			  initDate();
			}); 
			
			function loadCoachesData(url,sdate,edate){
				  $('#myModal').modal('show');
	  			  $.ajax({
					url:url,
					type:'post',
					data:{'ssdq':localStorage["ssdq"],'ssxs':localStorage["ssxs"],'begin':sdate,'end':edate},
					success:function(result){
						$('#myModal').modal('hide');
	  				if(result!=null){
				        var dataObj = result;
			        	if(dataObj!=null){
			        		var dataList = dataObj.datas;
			        		if(dataList==null){
	  			        	  alert("没有查询到相关数据!");	
	  			        	  return;
	  			        	}
			        		var dataListObj = eval("("+dataList+")");
			        		if(dataListObj==null){
			        		  alert("没有查询到相关数据!");	
			        		  return;
	  	  			        }
	  	  			        var tempData = null;
		  	  			    var htmlHeader = '<tr class="row" style="height:4rem;"><td class="col-xs-3" style="text-align:center;">车牌号</td><td class="col-xs-2">上报时间</td><td class="col-xs-4">上报信息</td><td class="col-xs-3">反馈状态</td></tr>';
		  					var htmlStr = "";var tempStatus;
			        		for(var i=0;i<dataListObj.length;i++){
			        			tempData = dataListObj[i];
			        			if(tempData!=null){
			        				var tempStatus = tempData.stype;
			        				var statusTxt = "未知状态";
			        				if(tempStatus==0){
			        					statusTxt = "已上报";
				        			}else if(tempStatus==1){
				        				statusTxt = "已处理";
					        			}
			        				htmlStr+='<tr class="row" style="height:4rem;"><td class="col-xs-3" onclick="javascript:selectCar('+i+')">'+tempData.vehicle+'</td><td class="col-xs-2">'+tempData.uptime+'</td><td class="col-xs-4">'+tempData.upreason+'</td><td class="col-xs-3">'+statusTxt+'</td></tr>';;
			    				}
			        		}
			        		$("#data_list").html("");
			    				$("#data_list").append(htmlHeader+htmlStr).show();
				       }
			         }
				},error:function (XMLHttpRequest, textStatus, errorThrown) {
					$('#myModal').modal('hide');
					}
				});
	  		}
			
			function searchStatData(){
				//根据时间查询统计数据
				//这里为模拟数据
				var stime = $("#start_time").val();
				var etime = $("#end_time").val();
				//alert(content);
				//$("#result").html(content);
				if(stime==null || stime=="" || stime.length<1){
					alert("开始时间不能为空!");
					return;
				}
				if(etime==null || etime=="" || etime.length<1){
					alert("结束时间不能为空!");
					return;
				}
				//var htmlStr = "";
				//htmlStr += '<h4 style="margin-left:1.6rem;">2015年合计99999人次</h4><h4 style="margin-left:1.6rem;">12月份合计1000人次</h4>';
				//$("#stat_data").append(htmlStr);
				loadCoachesData("/ZgGwork/AbnormalBookServlet",stime,etime);
			}

			function initDate(){
				var myDate=new Date();
				var beginDate = myDate.getFullYear()+"-"+(myDate.getMonth()+1)+"-1";
				//var currentDate = myDate.toLocaleDateString();
				var currentDate = myDate.getFullYear()+"-"+(myDate.getMonth()+1)+"-"+myDate.getDate();
				//loadCoachesData("/ZgGwork/AbnormalBookServlet",beginDate,currentDate);
				$("#start_time").val(beginDate);
				$("#end_time").val(currentDate);
				loadCoachesData("/ZgGwork/AbnormalBookServlet",beginDate,currentDate);
			}

			function reback(){
			  window.history.back(-1);
			}
		</script>
		
	</body>
</html>

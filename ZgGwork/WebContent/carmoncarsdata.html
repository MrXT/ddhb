<!DOCTYPE html>
<html>
	<head>
		  <title>驾驶员培训行管平台</title>
		  <meta charset="utf-8">
		  <meta name="viewport" content="width=device-width, 
		                                     initial-scale=1.0, 
		                                     maximum-scale=1.0, 
		                                     user-scalable=no">
		  <link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css">  
		  <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
		  <script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
		  <link rel="stylesheet" href="css/foot.css" type="text/css" />
	</head>
	<body>
		
	<table style="width:100%;height:4rem;">
    	<tr class="row" style="height:100%;width:100%;background:#2BB464;">
    		<td class="col-xs-1 btn-primary" style="height:100%;text-align:center;background:#2BB464;" onclick="reback()"><img style="width:1rem;height:1.4rem;" src='img/ic_reback.png'/></td>
    		<td class="col-xs-11" style="height:100%;text-align:left;"><strong id="title_txt" style="color:#ffffff;font-size:1.7rem;">车辆动态监控</strong></td>
    	</tr>
    </table>
    <table border="0" id="cars_list">
	</table>
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
		   aria-labelledby="myModalLabel" aria-hidden="true">
		   <div class="modal-dialog">
		      <div class="modal-content">
		         <div class="modal-body">
		           努力加载中,请稍后...
		         </div>
		    </div>
		   </div>
	</div>
         <script type="text/javascript">
            $(function(){
			  //createSchoolDetailData();
              GetArgsFromHref(location.href,"data");
			}); 
			
			function goLoc(data){
			  window.location.href="carmon.html?data="+JSON.stringify(data); 
			}
			function loadCarsData(url,sCode){
				  $('#myModal').modal('show');
	  			  $.ajax({
					url:url,
					type:'post',
					data:{'ssdq':localStorage["ssdq"],'ssxs':localStorage["ssxs"],'drivecode':sCode},
					success:function(result){
					$('#myModal').modal('hide');
	  				if(result!=null){
				        var dataObj = result;
			        	if(dataObj!=null){
			        		var dataList = dataObj.datas;
			        		if(dataList==null){
			        		  alert("没有获取到相关数据!");	
	  			        	  return;
	  			        	}
			        		var dataListObj = eval("("+dataList+")");
			        		if(dataListObj==null){
			        		  alert("没有获取到相关数据!");		
			        		  return;
	  	  			        }
	  	  			        var tempData = null;
		  	  			    var htmlHeader = '<tr class="row" style="height:4rem;text-align:center;"><td class="col-xs-7">车牌号</td><td class="col-xs-5">定位状态</td></tr>';
		  					var htmlStr = "";
			        		for(var i=0;i<dataListObj.length;i++){
			        			tempData = dataListObj[i];
			        			if(tempData!=null){
			        				htmlStr+='<tr class="row" style="height:4rem;text-align:center;"><td class="col-xs-7"><a onclick=\'javascript:goLoc('+JSON.stringify(tempData)+');\'>'+tempData.cph+'</a></td><td class="col-xs-5">正常</td></tr>';;
			        			}
			        	    }
			        		$("#cars_list").append(htmlHeader+htmlStr).show();
						}
			         }
				},error:function (XMLHttpRequest, textStatus, errorThrown) {$('#myModal').modal('hide');}
				});
	  		}
			
			var schoolId = null;
			function GetArgsFromHref(sHref, sArgName) {
			    var args = sHref.split("?");
			    var retval = "";
			    if (args[0] == sHref) /*参数为空*/ {
			        return retval; /*无需做任何处理*/
			    }
			    var str = args[1];
			    args = str.split("&");
			    for (var i = 0; i < args.length; i++) {
			        str = args[i];
			        var arg = str.split("=");
			        if (arg.length <= 1) continue;
			        if (arg[0] == sArgName) retval = arg[1];
			    }
			    //alert(retval);
			    var data = decodeURI(retval);
			    data = eval("("+data+")");
			    schoolId = data.drivecode;
			    $("#title_txt").html(data.yhmc);
			    //return retval;
			    //查询驾校详细信息
			    loadCarsData("/ZgGwork/car",name);
			}
			function reback()
			{
			  window.history.back(-1);
			}
		</script>
	</body>
</html>

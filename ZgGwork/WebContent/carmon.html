<!DOCTYPE html>
<html>
	<head>
		  <title>驾驶员培训行管平台</title>
		  <meta charset="utf-8">
		  <meta name="viewport" content="width=device-width, 
		                                     initial-scale=1.0, 
		                                     maximum-scale=1.0, 
		                                     user-scalable=no">
		  <link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css">  
		  <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
		  <script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
		  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=iy45sXYo4UZSexPUc2vOSmQS"></script>
		  <style type="text/css">
			body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
		  </style>
	</head>
	<body>
		<table style="width:100%;height:4rem;">
	    	<tr class="row" style="height:100%;width:100%;background:#2BB464;">
	    		<td class="col-xs-1 btn-primary" style="height:100%;text-align:center;background:#2BB464;" id="toLeft" onclick="reback()"><img style="width:1rem;height:1.4rem;" src='img/ic_reback.png'/></td>
	    		<td class="col-xs-11" style="height:100%;text-align:left;"><strong id="title_txt" style="color:#ffffff;font-size:1.7rem;">车辆动态监控</strong></td>
	    	</tr>
        </table>
	    <div id="allmap"></div>
	    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
		   aria-labelledby="myModalLabel" aria-hidden="true">
		   <div class="modal-dialog">
		      <div class="modal-content">
		         <div class="modal-body">
		           努力加载中,请稍后...
		         </div>
		    </div>
		   </div>
	    </div>
		<script type="text/javascript">
            $(function(){
              /*
            	$("#toLeft").mousedown(function(){
                $("#toLeft").css({"opacity":"0.9"});
              });
			  initMap();
			  */
			  GetArgsFromHref(location.href,"data");
			}); 
			
			/*function initMap(){
			    // 百度地图API功能
				var map = new BMap.Map("allmap");    // 创建Map实例
				map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别
				map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
				map.setCurrentCity("北京");          // 设置地图显示的城市 此项是必须设置的
				map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
			}*/
			function loadLocData(url,plat){
				  $('#myModal').modal('show');
	  			  $.ajax({
					url:url,
					type:'post',
					data:{'ssdq':localStorage["ssdq"],'ssxs':localStorage["ssxs"],'vehicle':plat},
					success:function(result){
					$('#myModal').modal('hide');
	  				if(result!=null){
				        var dataObj = result;
			        	if(dataObj!=null){
			        		var dataList = dataObj.datas;
			        		if(dataList==null){
			        		  alert("没有获取到相关数据!");	
	  			        	  return;
	  			        	}
			        		var dataListObj = eval("("+dataList+")");
			        		if(dataListObj==null){
			        		  alert("没有获取到相关数据!");		
			        		  return;
	  	  			        }
	  	  			        var tempData = null;
		  	  			    var htmlStr = "";
			        		tempData = dataListObj[0];
		        			if(tempData!=null){
		        				//htmlStr+='<tr class="row" style="height:4rem;text-align:center;"><td class="col-xs-7"><a onclick=\'javascript:goLoc('+JSON.stringify(tempData)+');\'>'+tempData.cph+'</a></td><td class="col-xs-5">正常</td></tr>';;
                                alert("经度："+tempData.Longitude+",纬度："+tempData.Latitude);
                                createMap(tempData.Longitude/1000000, tempData.Latitude/1000000);
			        		}
			        	}
			         }
				},error:function (XMLHttpRequest, textStatus, errorThrown) {$('#myModal').modal('hide');}
				});
	  		}
			function createMap(lng, lat) {
				 //在百度地图容器中创建一个地图
				 var map = new BMap.Map("allmap");
				 var point = new BMap.Point(lng, lat); //定义一个中心点坐标
				 var myIcon = new BMap.Icon("img/ic_loc.png", new BMap.Size(50,50));
				 var marker = new BMap.Marker(point,{icon:myIcon});  // 创建标注
				 map.addOverlay(marker);   
				 map.centerAndZoom(point, 12);  
		    }
		    
			function GetArgsFromHref(sHref, sArgName) {
			    var args = sHref.split("?");
			    var retval = "";
			    if (args[0] == sHref) /*参数为空*/ {
			        return retval; /*无需做任何处理*/
			    }
			    var str = args[1];
			    args = str.split("&");
			    for (var i = 0; i < args.length; i++) {
			        str = args[i];
			        var arg = str.split("=");
			        if (arg.length <= 1) continue;
			        if (arg[0] == sArgName) retval = arg[1];
			    }
			    //alert(retval);
			    var data = decodeURI(retval);
			    data = eval("("+data+")");
			    //schoolId = data.drivecode;
			    $("#title_txt").html(data.cph);
			    //return retval;
			    loadLocData("/ZgGwork/CarLocServlet",data.cph);
			}
			function reback(){
			  window.history.back(-1);
			}
		</script>
	</body>
</html>
